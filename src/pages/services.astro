---
// import BaseLayout from "../layouts/BaseLayout.astro";

import BaseLayout from "@layouts/BaseLayout.astro";
import Residential from "@components/Services/Residential.astro";
import Commercial from "@components/Services/Commercial.astro";
import Restoration from "@components/Services/Restoration.astro";
import CTALink from "@components/CTALink.astro";

import { Icon } from "astro-icon/components";
// import { Image } from "astro:assets";
import { getImage } from "astro:assets";
import { Image } from "astro-lqip/components";
import CTA from "@components/CTA.astro";

// Import local images - replace these with your actual images
// For now, using placeholder structure
import sealed from "@assets/images/coatings/sealed.png";
import landingImage from "@assets/images/home-landing.png";

type ServiceSection = {
  id: string;
  icon: string;
  label: string;
};

const serviceSections: ServiceSection[] = [
  { id: "residential-coatings", icon: "tabler:home-2", label: "Residential" },
  {
    id: "commercial-industrial-flooring",
    icon: "tabler:building-factory-2",
    label: "Commercial",
  },
  {
    id: "concrete-sealing-repair",
    icon: "tabler:tools",
    label: "Sealing & Repair",
  },
  {
    id: "flake-colors-customization",
    icon: "tabler:palette",
    label: "Flake Colors",
  },
];

type BenefitItem = {
  icon: string;
  text: string;
};

type UseCase = {
  icon: string;
  text: string;
};

const optimizedImage = await getImage({ src: landingImage, format: "avif" });
---

<BaseLayout ogImage={optimizedImage}>
 <!-- ============================================ -->
  <!--                 Page Hero                    -->
  <!-- ============================================ -->
  <section class="relative overflow-hidden bg-neutral-900 pt-28 pb-20 sm:pt-36 sm:pb-28 lg:pt-44 lg:pb-36">
    <!-- BACKGROUND WRAPPER (Target for Scale Up 1 -> 1.2) -->
    <div
      id="hero-bg-wrapper"
      class="absolute inset-0 z-0 h-full w-full will-change-transform"
    >
      <Image
        src={landingImage}
        alt="Epoxy Flooring Edmonton"
        class="h-full w-full object-cover"
        loading="eager"
        lqip="base64"
        lqipSize={10}
      />
      <div class="absolute inset-0 bg-black/20"></div>
    </div>

    <!-- Gradient overlay -->
    <div class="absolute inset-0 bg-gradient-to-br from-neutral-900 via-neutral-900/95 to-neutral-800"></div>

    <div class="relative z-10 mx-auto max-w-7xl px-4 sm:px-8">
      <div class="max-w-3xl">
        <span
          class="mb-4 inline-block font-mont text-sm font-bold tracking-widest text-accent uppercase"
          data-reveal
          data-direction="left"
          data-distance-x="30"
          data-once="true"
        >
          Our Services
        </span>
        <h1
          class="mb-6 font-mont text-4xl font-extrabold leading-tight text-fore-light sm:text-5xl lg:text-6xl"
          data-reveal
          data-direction="left"
          data-distance-x="30"
          data-delay-s="0.1"
          data-once="true"
        >
          Premium Concrete Coating Solutions
        </h1>
        <p
          class="mb-8 font-mont text-lg leading-relaxed text-fore-light/80 sm:text-xl"
          data-reveal
          data-direction="left"
          data-distance-x="30"
          data-delay-s="0.15"
          data-once="true"
        >
          From residential garages to industrial warehouses, we deliver durable, beautiful floors that last. Explore our services below.
        </p>

        <!-- Quick Nav Pills -->
        <div
          class="flex flex-wrap gap-3"
          data-reveal
          data-direction="left"
          data-distance-x="30"
          data-delay-s="0.2"
          data-once="true"
        >
          {serviceSections.map((section) => (
            <a
              href={`#${section.id}`}
              class="group inline-flex items-center gap-2 rounded-full inset-shadow-border/30 bg-fore-dark/30 px-4 py-2 font-mont text-sm font-medium text-neutral-300 transition-all duration-300 hover:inset-shadow-border hover:bg-primary/30 hover:text-accent"
            >
              <Icon name={section.icon} class="size-4" />
              {section.label}
            </a>
          ))}
        </div>
      </div>
    </div>

    <!-- Decorative element -->
    <div class="absolute right-0 bottom-0 hidden h-64 w-64 translate-x-1/4 translate-y-1/4 rounded-full bg-accent/5 blur-3xl lg:block"></div>
  </section>

  <!-- ============================================ -->
  <!--            Sticky Section Nav               -->
  <!-- ============================================ -->
  <nav
    class="sticky top-17.5 z-40 border-b border-fore-light/80 bg-white/95 backdrop-blur-sm md:top-24"
    id="service-nav"
  >
    <div class="mx-auto max-w-7xl px-4 sm:px-8">
      <div class="scrollbar-hide flex gap-1 overflow-x-auto py-3 sm:justify-center sm:gap-2">
        {serviceSections.map((section) => (
          <a
            href={`#${section.id}`}
            class="service-nav-link group flex shrink-0 items-center gap-2 rounded-sm px-4 py-2.5 font-mont text-sm font-semibold text-fore-dark/80 transition-all duration-300 hover:bg-fore-light hover:text-fore-dark"
            data-section={section.id}
          >
            <Icon
              name={section.icon}
              class="size-4 text-primary/50 transition-colors group-hover:text-primary"
            />
            <span class="hidden sm:inline">{section.label}</span>
            <span class="sm:hidden">{section.label.split(' ')[0]}</span>
          </a>
        ))}
      </div>
    </div>
  </nav>

  <!-- ============================================ -->
  <!--          Residential Coatings               -->
  <!-- ============================================ -->
  <Residential />

  <!-- Divider -->
  <div class="mx-auto max-w-7xl px-4 sm:px-8">
    <div class="h-px bg-gradient-to-r from-transparent via-fore-light to-transparent"></div>
  </div>

  <!-- ============================================ -->
  <!--       Commercial & Industrial Flooring      -->
  <!-- ============================================ -->
  <Commercial />

  <!-- Divider -->
  <div class="mx-auto max-w-7xl px-4 sm:px-8">
    <div class="h-px bg-gradient-to-r from-transparent via-fore-light to-transparent"></div>
  </div>

  <!-- Divider -->
  <!-- <div class="mx-auto max-w-7xl px-4 sm:px-8">
    <div class="h-px bg-gradient-to-r from-transparent via-neutral-200 to-transparent"></div>
  </div> -->



  <!-- ============================================ -->
  <!--          Concrete Sealing & Repair          -->
  <!-- ============================================ -->

  <Restoration />

  <!-- ============================================ -->
  <!--         Flake Colors / Customization        -->
  <!-- ============================================ -->
  <section
    id="flake-colors-customization"
    class="scroll-mt-32 bg-neutral-900 px-4 py-section-padding sm:px-8"
  >
    <div class="mx-auto max-w-7xl">
      <!-- Header -->
      <div class="mb-12 text-center">
        <div
          class="mb-4 flex items-center justify-center gap-3"
          data-reveal
          data-direction="bottom"
          data-distance-y="30"
          data-once="true"
        >
          <div class="flex size-12 items-center justify-center rounded-full bg-accent/10">
            <Icon name="tabler:palette" class="size-6 text-accent" />
          </div>
        </div>

        <span
          class="mb-2 block font-mont text-sm font-bold tracking-widest text-accent uppercase"
          data-reveal
          data-direction="bottom"
          data-distance-y="30"
          data-delay-s="0.05"
          data-once="true"
        >
          Customization
        </span>

        <h2
          class="mb-6 font-mont text-3xl font-bold text-fore-light sm:text-4xl"
          data-reveal
          data-direction="bottom"
          data-distance-y="30"
          data-delay-s="0.1"
          data-once="true"
        >
          Flake Colors & Custom Finishes
        </h2>

        <p
          class="mx-auto max-w-2xl font-mont text-lg leading-relaxed text-fore-light/80"
          data-reveal
          data-direction="bottom"
          data-distance-y="30"
          data-delay-s="0.15"
          data-once="true"
        >
          Choose from a wide range of decorative flake colors to make your floors unique. Mix and match colors to match your style or brand identity.
        </p>
      </div>

      <!-- Color Categories -->
      <div
        class="mb-12 grid gap-8 sm:grid-cols-2 lg:grid-cols-4"
        data-stagger-child-b
        data-distance-y="40"
        data-delay-s="0.2"
        data-once="true"
      >
        {[
          {
            name: "Gray & White",
            colors: ["#6B7280", "#9CA3AF", "#D1D5DB", "#F3F4F6", "#FFFFFF"],
            description: "Classic, clean aesthetics",
          },
          {
            name: "Blue & Silver",
            colors: ["#1E40AF", "#3B82F6", "#60A5FA", "#93C5FD", "#C0C0C0"],
            description: "Modern, professional look",
          },
          {
            name: "Earth Tones",
            colors: ["#78350F", "#92400E", "#B45309", "#D4A574", "#E7D4B5"],
            description: "Warm, natural appearance",
          },
          {
            name: "Custom Mix",
            colors: ["linear-gradient(135deg, #F59E0B 0%, #3B82F6 50%, #10B981 100%)"],
            isGradient: true,
            description: "Your unique combination",
          },
        ].map((category) => (
          <div class="rounded-sm bg-neutral-800 p-6 transition-all duration-300 hover:bg-neutral-800/80">
            <div class="mb-4 flex gap-2">
              {category.isGradient ? (
                <div
                  class="h-8 w-full rounded-full"
                  style={`background: ${category.colors[0]}`}
                />
              ) : (
                category.colors.map((color) => (
                  <div
                    class="size-8 rounded-full border-2 border-neutral-700"
                    style={`background-color: ${color}`}
                  />
                ))
              )}
            </div>
            <h3 class="mb-1 font-mont text-lg font-bold text-fore-light">
              {category.name}
            </h3>
            <p class="font-mont text-sm text-fore-light/80">
              {category.description}
            </p>
          </div>
        ))}
      </div>

      <!-- Sample Floors Gallery -->
      <div
        class="mb-12"
        data-reveal
        data-direction="bottom"
        data-distance-y="40"
        data-delay-s="0.3"
        data-once="true"
      >
        <h3 class="mb-6 text-center font-mont text-xl font-bold text-fore-light">
          Sample Installations
        </h3>
        <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
          {[
            { name: "Midnight Blue", color: "bg-blue-900" },
            { name: "Granite Gray", color: "bg-neutral-600" },
            { name: "Desert Sand", color: "bg-amber-200" },
          ].map((sample) => (
            <div class="group relative overflow-hidden rounded-sm">
              <div class={`h-48 ${sample.color} relative`}>
                <!-- Flake pattern overlay -->
                <div class="absolute inset-0 opacity-30" style="background-image: radial-gradient(circle at 20% 30%, white 1px, transparent 1px), radial-gradient(circle at 60% 70%, white 1px, transparent 1px), radial-gradient(circle at 80% 20%, white 1px, transparent 1px), radial-gradient(circle at 40% 80%, white 1px, transparent 1px); background-size: 20px 20px;"></div>
              </div>
              <div class="absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/80 to-transparent p-4">
                <p class="font-mont font-semibold text-white">{sample.name}</p>
              </div>
            </div>
          ))}
        </div>
      </div>

      <!-- CTA -->
      <div
        class="text-center"
        data-reveal
        data-direction="bottom"
        data-distance-y="30"
        data-delay-s="0.35"
        data-once="true"
      >
        <p class="mb-6 font-mont text-fore-light/80">
          Can't find the perfect color? We can create custom blends just for you.
        </p>

        <CTALink label={"Request Color Samples"} variant="primary" showIcon={true} />
        <!-- <a
          href="/contact"
          class:list={[
            "inline-flex items-center gap-2 px-8 py-4 font-mont font-bold",
            "border-2 border-amber-300 bg-amber-300 text-neutral-900 transition-all duration-400",
            "hover:rounded-lg hover:bg-transparent hover:text-amber-300",
          ]}
        >
          Request Color Samples
          <Icon name="tabler:palette" class="size-5" />
        </a> -->
      </div>
    </div>
  </section>

  <!-- ============================================ -->
  <!--                    CTA                      -->
  <!-- ============================================ -->
  <CTA />
</BaseLayout>

<script>
  // Smooth scroll for anchor links
  document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
    anchor.addEventListener("click", function (e) {
      e.preventDefault();
      const targetId = this.getAttribute("href")?.substring(1);
      if (targetId) {
        const target = document.getElementById(targetId);
        if (target) {
          target.scrollIntoView({
            behavior: "smooth",
            block: "start",
          });
          // Update URL without jumping
          history.pushState(null, "", `#${targetId}`);
        }
      }
    });
  });

  // Active section highlighting for sticky nav
  const observerOptions = {
    root: null,
    rootMargin: "-30% 0px -70% 0px",
    threshold: 0,
  };

  const navLinks = document.querySelectorAll(".service-nav-link");

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        const sectionId = entry.target.id;

        navLinks.forEach((link) => {
          const linkSection = link.getAttribute("data-section");
          if (linkSection === sectionId) {
            link.classList.add("bg-fore-light", "text-fore-dark");
            link.classList.remove("text-fore-dark/80");
            link.querySelector("svg")?.classList.add("text-primary");
            link.querySelector("svg")?.classList.remove("text-primary/50");
          } else {
            link.classList.remove("bg-fore-light", "text-fore-dark");
            link.classList.add("text-fore-dark/80");
            link.querySelector("svg")?.classList.remove("text-primary");
            link.querySelector("svg")?.classList.add("text-primary/50");
          }
        });
      }
    });
  }, observerOptions);

  // Observe all service sections
  document.querySelectorAll('section[id$="-coatings"], section[id$="-flooring"], section[id$="-repair"], section[id$="-customization"]').forEach((section) => {
    observer.observe(section);
  });

  // Handle initial hash on page load
  const initialHash = window.location.hash;
  if (initialHash) {
    setTimeout(() => {
      const target = document.querySelector(initialHash);
      if (target) {
        target.scrollIntoView({ behavior: "smooth", block: "start" });
      }
    }, 100);
  }
</script>

<style>
  /* Hide scrollbar for nav but allow scrolling */
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
</style>
